import e from"react";var t,n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{i(r.next(e))}catch(e){a(e)}}function c(e){try{i(r.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}i((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(i){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,r=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){s=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){s.label=c[1];break}if(6===c[0]&&s.label<o[1]){s.label=o[1],o=c;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(c);break}o[2]&&s.ops.pop(),s.trys.pop();continue}c=t.call(e,s)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}}var a={trackedAddress:"",allowances:{alca:{},alcb:{},mad:{}},balances:{alca:"n/a",alcb:"n/a",ethereum:"n/a",mad:"n/a"},positions:{staked:[],lockedPosition:{alcaReward:"",ethReward:"",exists:!1,lockedAlca:"",lockupPeriod:"START",penalty:"",remainingRewards:"",tokenId:"",unlockDate:""}},updateBalances:function(e){}},s=e.createContext(a),c="getMadBalance",i="getAlcaBalance",u="getAlcbBalance",l="getATokenAllowanceForMad",d="getStakedAlcaPositions",h="getLockedPosition",f=((t={})[c]=[c,function(e,t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.contractMethods.MADTOKEN.balanceOf_view_IN1_OUT1({_owner:t})];case 1:return n=r.sent(),[2,e.ethers.utils.formatEther(n)];case 2:return[2,{error:r.sent().message}];case 3:return[2]}}))}))}],t[i]=[i,function(e,t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.contractMethods.ATOKEN.balanceOf_view_IN1_OUT1({account:t})];case 1:return n=r.sent(),[2,e.ethers.utils.formatEther(n)];case 2:return[2,{error:r.sent().message}];case 3:return[2]}}))}))}],t[u]=[u,function(e,t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.contractMethods.BTOKEN.balanceOf_view_IN1_OUT1({account:t})];case 1:return n=r.sent(),[2,e.ethers.utils.formatEther(n)];case 2:return[2,{error:r.sent().message}];case 3:return[2]}}))}))}],t[l]=[l,function(e,t){var n,a;return r(this,void 0,void 0,(function(){var r,s;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,null===(a=null===(n=null==e?void 0:e.contractConfig)||void 0===n?void 0:n.ATOKEN)||void 0===a?void 0:a.address];case 1:if(!(r=o.sent()))throw new Error("Unable to determine AToken address from passed ethAdapter. Make sure ethAdapter.contractConfig is populating");return[4,e.contractMethods.MADTOKEN.allowance_view_IN2_OUT1({_owner:t,_spender:r})];case 2:return s=o.sent(),[2,e.ethers.utils.formatEther(s)];case 3:return[2,{error:o.sent()}];case 4:return[2]}}))}))}],t[d]=[d,function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s,c,i,u;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,p(e,t)];case 1:return n=o.sent(),[4,w(e,n)];case 2:for(r=o.sent(),a=[],s=0,c=r;s<c.length;s++)i=c[s],a.push({tokenId:i.tokenId.toString(),shares:e.ethers.utils.formatEther(i.shares),ethRewards:e.ethers.utils.formatEther(i.ethRewards.toString()),alcaRewards:e.ethers.utils.formatEther(i.alcaRewards.toString())});return[2,a];case 3:return u=o.sent(),console.log(u),[2,{error:u.message}];case 4:return[2]}}))}))}],t[h]=[h,function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s,c,i,u,l,d,h,f,v,_,p,w,b;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,12,,13]),[4,I(e,t)];case 1:return(n=o.sent())>0?[4,O(e,n)]:[3,3];case 2:return u=o.sent(),[3,4];case 3:u={},o.label=4;case 4:return a=(r=u).payoutEth,s=void 0===a?0:a,c=r.payoutToken,i=void 0===c?0:c,n>0?[4,m(e,n)]:[3,6];case 5:return h=o.sent(),[3,7];case 6:h=0,o.label=7;case 7:return l=h.shares,d=void 0===l?0:l,[4,e.contractMethods.LOCKUP.getLockupEndBlock_view_IN0_OUT1()];case 8:return f=o.sent(),[4,e.provider.getBlockNumber()];case 9:return v=o.sent(),[4,e.contractMethods.LOCKUP.SCALING_FACTOR_view_IN0_OUT1()];case 10:return _=o.sent(),[4,e.contractMethods.LOCKUP.FRACTION_RESERVED_view_IN0_OUT1()];case 11:return p=o.sent(),w=e.ethers.BigNumber.from(p).mul(100).div(_),b=100-w,[2,{lockedAlca:e.ethers.utils.formatEther(d),payoutEth:e.ethers.utils.formatEther(s),payoutToken:e.ethers.utils.formatEther(i),tokenId:n.toString(),lockupPeriod:e.ethers.BigNumber.from(f).gt(v)?"LOCKED":"END",penalty:w.toString(),blockUntilUnlock:e.ethers.BigNumber.from(f).sub(v).toString(),remainingRewards:b}];case 12:return[2,{error:o.sent().message}];case 13:return[2]}}))}))}],t);function v(t){var f=this,v=t.children,p=t.ethAdapter,w=e.useState(a),b=w[0],k=w[1],m=function(e){return r(f,void 0,void 0,(function(){var t,r,a,s,f,v,p,w,b,m,I,O,T,g;return o(this,(function(o){switch(o.label){case 0:if(!e)throw new Error("ethAdapter must be passed to updateBalances()!");return t=e.connectedAccount,[4,e.updateEthereumBalance()];case 1:return o.sent(),"0x0"!==e.contractConfig.BTOKEN.address?[3,3]:(console.warn("BToken was set to 0x0... using Factory.lookup() to populate BTOKEN address."),[4,e.contractMethods.FACTORY.lookup_view_IN1_OUT1({salt_:e.ethers.utils.formatBytes32String("BToken")})]);case 2:r=o.sent(),e.contractConfig.BTOKEN.address=r,o.label=3;case 3:return[4,_([[c,[e,t]],[i,[e,t]],[u,[e,t]],[l,[e,t]],[d,[e,t]],[h,[e,t]]])];case 4:return a=o.sent(),s={alcaBalance:a[i],alcbBalance:a[u],madBalance:a[c],alcaMadAllowance:a[l],stakedPositions:a[d],lockedPosition:a[h]},f=s.madBalance,p=s.alcbBalance,w=s.alcaMadAllowance,b=s.stakedPositions,m=s.lockedPosition,I={alca:(v=s.alcaBalance).error?v.error:v.toString(),alcb:p.error?p.error:p.toString(),ethereum:e.balances.ethereum,mad:f.error?f.error:f.toString()},O={alca:{},alcb:{},mad:(g={},g[e.contractConfig.ATOKEN.address]=w.error?w.error:w.toString(),g)},T={staked:b,locked:m},k((function(e){return n(n({},e),{balances:n(n({},e.balances),I),allowances:n(n({},e.allowances),{alca:n(n({},e.allowances.alca),O.alca),alcb:n(n({},e.allowances.alcb),O.alcb),mad:n(n({},e.allowances.mad),O.mad)}),positions:{lockedPosition:T.locked,staked:T.staked},trackedAddress:t})})),[2]}}))}))};return e.useEffect((function(){var e=function(){return r(f,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return p.connectedAccount&&m(p),[4,(n=1e4,new Promise((function(e){return setTimeout(e,n)})))];case 1:return t.sent(),e(),[2]}var n}))}))};e()}),[]),e.createElement(s.Provider,{value:n(n({},b),{updateBalances:m})},v)}function _(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,c,i,u,l,d,h,v;return o(this,(function(o){switch(o.label){case 0:for(t={},n=[],r=[],a=0,s=e;a<s.length;a++){if(c=s[a],i=c[0],u=c[1],l=f[c[0]],d=l[1],!i||!d)throw new Error("Check prettyFunctionIDs config, functionName !== givenPrettyName");"function"==typeof d&&(r.push(i),n.push(d.apply(null,u)))}return[4,Promise.all(n)];case 1:for(h=o.sent(),v=0;v<h.length;v++)t[r[v]]=h[v];return[2,t]}}))}))}function p(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s;return o(this,(function(o){switch(o.label){case 0:n=[],r=!0,a=0,o.label=1;case 1:return r?[4,e.contractMethods.PUBLICSTAKING.tokenOfOwnerByIndex_view_IN2_OUT1({owner:t,index:a})]:[3,3];case 2:return(s=o.sent()).error?(r=!1,[3,3]):(s&&n.push(s),a++,[3,1]);case 3:return[2,n]}}))}))}function w(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s,c,i,u,l,d;return o(this,(function(o){switch(o.label){case 0:n=[],r=0,a=t,o.label=1;case 1:return r<a.length?(s=a[r],[4,e.contractMethods.PUBLICSTAKING.tokenURI_view_IN1_OUT1({tokenID_:s})]):[3,6];case 2:if((c=o.sent()).error)throw new Error(c.error);return i=function(e){var t=e.split("data:application/json;utf8,")[1];return t?JSON.parse(t):{}}(c).attributes,u=function(e,t){return e&&e.length&&e.find((function(e){return e.trait_type===t}))}(i,"Shares"),[4,b(e,s)];case 3:return l=o.sent(),[4,k(e,s)];case 4:d=o.sent(),n.push({tokenId:s,shares:u.value,ethRewards:l,alcaRewards:d}),o.label=5;case 5:return r++,[3,1];case 6:return[2,n]}}))}))}function b(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.estimateEthCollection_view_IN1_OUT1({tokenID_:t})];case 1:return[2,n.sent()]}}))}))}function k(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.estimateTokenCollection_view_IN1_OUT1({tokenID_:t})];case 1:return[2,n.sent()]}}))}))}function m(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.getPosition_view_IN1_OUT5({tokenID_:t})];case 1:return[2,n.sent()]}}))}))}function I(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){return[2,e.contractMethods.LOCKUP.tokenOf_view_IN1_OUT1({acct_:t})]}))}))}function O(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.LOCKUP.estimateProfits_view_IN1_OUT2({tokenID_:t})];case 1:return[2,n.sent()]}}))}))}var T={sendMadAllowanceForATokenRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.MADTOKEN.approve_nonpayable_IN2_OUT1({_spender:e.contractConfig.ATOKEN.address,_value:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},sendMigrateRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.ATOKEN.migrate_nonpayable_IN1_OUT1({amount:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},sendAtokenAllowanceForPublicStakingRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.ATOKEN.approve_nonpayable_IN2_OUT1({spender:e.contractConfig.PUBLICSTAKING.address,amount:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},sendOpenPublicStakingPositionRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.mint_nonpayable_IN1_OUT1({amount_:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},sendClaimAllPublicStakingRewardsRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.collectAllProfits_nonpayable_IN1_OUT2({tokenID_:t})];case 1:return[2,n.sent()]}}))}))},sendUnstakePublicStakedPositionRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){return e.contractMethods.PUBLICSTAKING.burn_nonpayable_IN1_OUT2({tokenID_:t}),[2]}))}))},sendLockStakePositionWithSafeTransferFromRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.safeTransferFrom_nonpayable_IN3_OUT0({from:e.getAddressByIndex(0),to:e.contractConfig.LOCKUP.address,tokenId:t})];case 1:return[2,n.sent()]}}))}))},sendCollectAllRewardsFromLockupRequest:function(e){return r(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,e.contractMethods.LOCKUP.collectAllProfits_nonpayable_IN0_OUT2()];case 1:return[2,t.sent()]}}))}))},estimateLockedPositionRewards:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.LOCKUP.estimateProfits_view_IN1_OUT2({tokenID_:t})];case 1:return[4,n.sent()];case 2:return[2,n.sent()]}}))}))},getEstimateForFinalBonusProfitsFromLockupPosition:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.LOCKUP.estimateFinalBonusWithProfits_view_IN1_OUT4({tokenID_:t})];case 1:return[4,n.sent()];case 2:return[2,n.sent()]}}))}))},sendAggregateLockupProfitsRequest:function(e){return r(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,e.contractMethods.LOCKUP.aggregateProfits_nonpayable_IN0_OUT0()];case 1:return[2,t.sent()]}}))}))},sendExitLockedPositionEarlyRequest:function(e,t,n){return r(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.contractMethods.LOCKUP.unlockEarly_nonpayable_IN2_OUT2({exitValue_:e.ethers.utils.parseEther(t),stakeExit_:n})];case 1:return[4,r.sent()];case 2:return[2,r.sent()]}}))}))},sendExitLockedPositionRequest:function(e,t,n){return r(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.contractMethods.LOCKUP.unlock_nonpayable_IN2_OUT2({to_:t,stakeExit_:n})];case 1:return[2,r.sent()]}}))}))}};export{s as BalanceContext,v as BalanceContextProvider,T as commonEthRequests};
//# sourceMappingURL=index.js.map
