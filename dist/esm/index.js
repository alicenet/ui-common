import e from"react";var t,n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var a={trackedAddress:"",allowances:{alca:{},alcb:{},mad:{}},balances:{alca:"n/a",alcb:"n/a",ethereum:"n/a",mad:"n/a"},positions:{staked:[],lockedPosition:{alcaReward:"",ethReward:"",exists:!1,lockedAlca:"",lockupPeriod:"START",penalty:"",remainingRewards:"",tokenId:"",unlockDate:""}},updateBalances:function(e){}},s=e.createContext(a),i="getMadBalance",c="getAlcaBalance",u="getAlcbBalance",l="getATokenAllowanceForMad",d="getStakedAlcaPositions",h="getLockedPosition",f=((t={})[i]=[i,function(e,t){return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e.contractMethods.MADTOKEN.balanceOf_view_IN1_OUT1({_owner:t})];case 1:return n=o.sent(),[2,e.ethers.utils.formatEther(n)];case 2:return r=o.sent(),[2,{error:"getMadBalance(): "+String(r.message)}];case 3:return[2]}}))}))}],t[c]=[c,function(e,t){return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e.contractMethods.ATOKEN.balanceOf_view_IN1_OUT1({account:t})];case 1:return n=o.sent(),[2,e.ethers.utils.formatEther(n)];case 2:return r=o.sent(),[2,{error:"getAlcaBalance(): "+String(r.message)}];case 3:return[2]}}))}))}],t[u]=[u,function(e,t){return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e.contractMethods.BTOKEN.balanceOf_view_IN1_OUT1({account:t})];case 1:return n=o.sent(),[2,e.ethers.utils.formatEther(n)];case 2:return r=o.sent(),[2,{error:"getAlcbBalance(): "+String(r.message)}];case 3:return[2]}}))}))}],t[l]=[l,function(e,t){var n,a;return r(this,void 0,void 0,(function(){var r,s,i;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,null===(a=null===(n=null==e?void 0:e.contractConfig)||void 0===n?void 0:n.ATOKEN)||void 0===a?void 0:a.address];case 1:if(!(r=o.sent()))throw new Error("Unable to determine AToken address from passed ethAdapter. Make sure ethAdapter.contractConfig is populating");return[4,e.contractMethods.MADTOKEN.allowance_view_IN2_OUT1({_owner:t,_spender:r})];case 2:return s=o.sent(),[2,e.ethers.utils.formatEther(s)];case 3:return i=o.sent(),[2,{error:"getATokenAllowanceForMad(): "+String(i.message)}];case 4:return[2]}}))}))}],t[d]=[d,function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s,i,c,u;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,p(e,t)];case 1:return n=o.sent(),[4,k(e,n)];case 2:for(r=o.sent(),a=[],s=0,i=r;s<i.length;s++)c=i[s],a.push({tokenId:c.tokenId.toString(),shares:e.ethers.utils.formatEther(c.shares),ethRewards:e.ethers.utils.formatEther(c.ethRewards.toString()),alcaRewards:e.ethers.utils.formatEther(c.alcaRewards.toString())});return[2,a];case 3:return u=o.sent(),[2,{error:"getStakedAlcaPositions(): "+String(u.message)}];case 4:return[2]}}))}))}],t[h]=[h,function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s,i,c,u,l,d,h,f,v,_,p,k,b,g;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,12,,13]),[4,T(e,t)];case 1:return(n=o.sent())>0?[4,I(e,n)]:[3,3];case 2:return u=o.sent(),[3,4];case 3:u={},o.label=4;case 4:return a=(r=u).payoutEth,s=void 0===a?0:a,i=r.payoutToken,c=void 0===i?0:i,n>0?[4,w(e,n)]:[3,6];case 5:return h=o.sent(),[3,7];case 6:h=0,o.label=7;case 7:return l=h.shares,d=void 0===l?0:l,[4,e.contractMethods.LOCKUP.getLockupEndBlock_view_IN0_OUT1()];case 8:return f=o.sent(),[4,e.provider.getBlockNumber()];case 9:return v=o.sent(),[4,e.contractMethods.LOCKUP.SCALING_FACTOR_view_IN0_OUT1()];case 10:return _=o.sent(),[4,e.contractMethods.LOCKUP.FRACTION_RESERVED_view_IN0_OUT1()];case 11:return p=o.sent(),k=e.ethers.BigNumber.from(p).mul(100).div(_),b=100-k,[2,{lockedAlca:e.ethers.utils.formatEther(d),payoutEth:e.ethers.utils.formatEther(s),payoutToken:e.ethers.utils.formatEther(c),tokenId:n.toString(),lockupPeriod:e.ethers.BigNumber.from(f).gt(v)?"LOCKED":"END",penalty:k.toString(),blockUntilUnlock:e.ethers.BigNumber.from(f).sub(v).toString(),remainingRewards:b}];case 12:return g=o.sent(),[2,{error:"getLockedPosition(): "+String(g.message)}];case 13:return[2]}}))}))}],t);function v(t){var f=this,v=t.children,p=t.ethAdapter,k=e.useState(a),b=k[0],g=k[1],w=function(e){return r(f,void 0,void 0,(function(){var t,a,s,f,v,p,k,b,w,T,I,O,m,A,N,U,P,E,S,y=this;return o(this,(function(C){switch(C.label){case 0:if(!e)throw new Error("ethAdapter must be passed to updateBalances()!");return t=e.connectedAccount,[4,e.updateEthereumBalance()];case 1:return C.sent(),a=function(){return r(y,void 0,void 0,(function(){var t,n,r,a;return o(this,(function(o){switch(o.label){case 0:t=0,n=["AToken","BToken","PublicStaking","Lockup","ValidatorStaking"],o.label=1;case 1:return t<n.length?(r=n[t],[4,e.contractMethods.FACTORY.lookup_view_IN1_OUT1({salt_:e.ethers.utils.formatBytes32String(r)})]):[3,4];case 2:a=o.sent(),e.contractConfig[r.toUpperCase()].address=a,o.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},[4,a()];case 2:return C.sent(),[4,e.contractMethods.ATOKEN.getLegacyTokenAddress_view_IN0_OUT1()];case 3:return s=C.sent(),e.contractConfig.MADTOKEN.address=s,"0x0"!==e.contractConfig.BTOKEN.address?[3,5]:(console.warn("BToken was set to 0x0... using Factory.lookup() to populate BTOKEN address."),[4,e.contractMethods.FACTORY.lookup_view_IN1_OUT1({salt_:e.ethers.utils.formatBytes32String("BToken")})]);case 4:f=C.sent(),e.contractConfig.BTOKEN.address=f,C.label=5;case 5:return[4,_([[i,[e,t]],[c,[e,t]],[u,[e,t]],[l,[e,t]],[d,[e,t]],[h,[e,t]]])];case 6:for(v=C.sent(),p={alcaBalance:v[c],alcbBalance:v[u],madBalance:v[i],alcaMadAllowance:v[l],stakedPositions:v[d],lockedPosition:v[h]},m=0,A=[k=p.madBalance,b=p.alcaBalance,w=p.alcbBalance,T=p.alcaMadAllowance,I=p.stakedPositions,O=p.lockedPosition];m<A.length;m++)(N=A[m]).error&&console.error("BalanceContextError: "+String(N.error));return U={alca:b.error?{error:b.error}:b.toString(),alcb:w.error?{error:w.error}:w.toString(),ethereum:e.balances.ethereum,mad:k.error?{error:k.error}:k.toString()},P={alca:{},alcb:{},mad:(S={},S[e.contractConfig.ATOKEN.address]=T.error?{error:T.error}:T.toString(),S)},E={staked:I.error?{error:I.error}:I,locked:O.error?{error:O.error}:O},g((function(e){return n(n({},e),{balances:n(n({},e.balances),U),allowances:n(n({},e.allowances),{alca:n(n({},e.allowances.alca),P.alca),alcb:n(n({},e.allowances.alcb),P.alcb),mad:n(n({},e.allowances.mad),P.mad)}),positions:{lockedPosition:E.locked,staked:E.staked},trackedAddress:t})})),[2]}}))}))};return e.useEffect((function(){var e=function(){return r(f,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return p.connectedAccount&&w(p),[4,(n=1e4,new Promise((function(e){return setTimeout(e,n)})))];case 1:return t.sent(),e(),[2]}var n}))}))};e()}),[]),e.createElement(s.Provider,{value:n(n({},b),{updateBalances:w})},v)}function _(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,i,c,u,l,d,h,v;return o(this,(function(o){switch(o.label){case 0:for(t={},n=[],r=[],a=0,s=e;a<s.length;a++){if(i=s[a],c=i[0],u=i[1],l=f[i[0]],d=l[1],!c||!d)throw new Error("Check prettyFunctionIDs config, functionName !== givenPrettyName");"function"==typeof d&&(r.push(c),n.push(d.apply(null,u)))}return[4,Promise.all(n)];case 1:for(h=o.sent(),v=0;v<h.length;v++)t[r[v]]=h[v];return[2,t]}}))}))}function p(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s;return o(this,(function(o){switch(o.label){case 0:n=[],r=!0,a=0,o.label=1;case 1:return r?[4,e.contractMethods.PUBLICSTAKING.tokenOfOwnerByIndex_view_IN2_OUT1({owner:t,index:a})]:[3,3];case 2:return(s=o.sent()).error?(r=!1,[3,3]):(s&&n.push(s),a++,[3,1]);case 3:return[2,n]}}))}))}function k(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s,i,c,u,l,d;return o(this,(function(o){switch(o.label){case 0:n=[],r=0,a=t,o.label=1;case 1:return r<a.length?(s=a[r],[4,e.contractMethods.PUBLICSTAKING.tokenURI_view_IN1_OUT1({tokenID_:s})]):[3,6];case 2:if((i=o.sent()).error)throw new Error(i.error);return c=function(e){var t=e.split("data:application/json;utf8,")[1];return t?JSON.parse(t):{}}(i).attributes,u=function(e,t){return e&&e.length&&e.find((function(e){return e.trait_type===t}))}(c,"Shares"),[4,b(e,s)];case 3:return l=o.sent(),[4,g(e,s)];case 4:d=o.sent(),n.push({tokenId:s,shares:u.value,ethRewards:l,alcaRewards:d}),o.label=5;case 5:return r++,[3,1];case 6:return[2,n]}}))}))}function b(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.estimateEthCollection_view_IN1_OUT1({tokenID_:t})];case 1:return[2,n.sent()]}}))}))}function g(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.estimateTokenCollection_view_IN1_OUT1({tokenID_:t})];case 1:return[2,n.sent()]}}))}))}function w(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.getPosition_view_IN1_OUT5({tokenID_:t})];case 1:return[2,n.sent()]}}))}))}function T(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){return[2,e.contractMethods.LOCKUP.tokenOf_view_IN1_OUT1({acct_:t})]}))}))}function I(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.LOCKUP.estimateProfits_view_IN1_OUT2({tokenID_:t})];case 1:return[2,n.sent()]}}))}))}var O={migrate_sendMadAllowanceForATokenRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.MADTOKEN.approve_nonpayable_IN2_OUT1({_spender:e.contractConfig.ATOKEN.address,_value:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},migrate_sendMigrateRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.ATOKEN.migrate_nonpayable_IN1_OUT1({amount:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},staking_sendAtokenAllowanceForPublicStakingRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.ATOKEN.approve_nonpayable_IN2_OUT1({spender:e.contractConfig.PUBLICSTAKING.address,amount:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},staking_sendOpenPublicStakingPositionRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.mint_nonpayable_IN1_OUT1({amount_:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},staking_sendClaimAllPublicStakingRewardsRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.collectAllProfits_nonpayable_IN1_OUT2({tokenID_:t})];case 1:return[2,n.sent()]}}))}))},staking_sendUnstakePublicStakedPositionRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){return e.contractMethods.PUBLICSTAKING.burn_nonpayable_IN1_OUT2({tokenID_:t}),[2]}))}))},lockup_sendLockStakePositionWithSafeTransferFromRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.PUBLICSTAKING.safeTransferFrom_nonpayable_IN3_OUT0({from:e.getAddressByIndex(0),to:e.contractConfig.LOCKUP.address,tokenId:t})];case 1:return[2,n.sent()]}}))}))},lockup_sendCollectAllRewardsFromLockupRequest:function(e){return r(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,e.contractMethods.LOCKUP.collectAllProfits_nonpayable_IN0_OUT2()];case 1:return[2,t.sent()]}}))}))},lockup_estimateLockedPositionRewards:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.LOCKUP.estimateProfits_view_IN1_OUT2({tokenID_:t})];case 1:return[4,n.sent()];case 2:return[2,n.sent()]}}))}))},lockup_getEstimateForFinalBonusProfitsFromLockupPosition:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.LOCKUP.estimateFinalBonusWithProfits_view_IN1_OUT4({tokenID_:t})];case 1:return[4,n.sent()];case 2:return[2,n.sent()]}}))}))},lockup_sendAggregateLockupProfitsRequest:function(e){return r(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,e.contractMethods.LOCKUP.aggregateProfits_nonpayable_IN0_OUT0()];case 1:return[2,t.sent()]}}))}))},lockup_sendExitLockedPositionEarlyRequest:function(e,t,n){return r(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.contractMethods.LOCKUP.unlockEarly_nonpayable_IN2_OUT2({exitValue_:e.ethers.utils.parseEther(t),stakeExit_:n})];case 1:return[4,r.sent()];case 2:return[2,r.sent()]}}))}))},lockup_sendExitLockedPositionRequest:function(e,t,n){return r(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.contractMethods.LOCKUP.unlock_nonpayable_IN2_OUT2({to_:t,stakeExit_:n})];case 1:return[2,r.sent()]}}))}))},psrouter_sendApproveMadTokenForPublicStakingRouterRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.MADTOKEN.approve_nonpayable_IN2_OUT1({_spender:e.contractConfig.PUBLICSTAKINGROUTER.address,_value:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},psrouter_sendApproveAlcaTokenForPublicStakingRouterRequest:function(e,t){return r(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.contractMethods.ATOKEN.approve_nonpayable_IN2_OUT1({_spender:e.contractConfig.PUBLICSTAKINGROUTER.address,_value:e.ethers.utils.parseEther(t)})];case 1:return[2,n.sent()]}}))}))},psrouter_sendMigrateAndStakeRequestToPublicStakingRouter:function(e,t,n){return r(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.contractMethods.PUBLICSTAKINGROUTER.migrateAndStake_nonpayable_IN3_OUT0({stakingAmount_:e.ethers.utils.parseEther(t),to:n})];case 1:return[2,r.sent()]}}))}))},psrouter_sendStakeAndLockRequestToPublicStakingRouter:function(e,t,n){return r(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.contractMethods.PUBLICSTAKINGROUTER.stakeAndLock_nonpayable_IN2_OUT0({stakingAmount_:e.ethers.utils.parseEther(t),to_:n})];case 1:return[2,r.sent()]}}))}))},psrouter_sendMigrateStakeLockRequestToPublicStakingRouter:function(e,t,n,a){return r(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.contractMethods.PUBLICSTAKINGROUTER.migrateStakeAndLock_nonpayable_IN3_OUT0({migrationAmount_:e.ethers.utils.parseEther(t),stakingAmount_:e.ethers.utils.parseEther(n),to_:a})];case 1:return[2,r.sent()]}}))}))}};export{s as BalanceContext,v as BalanceContextProvider,O as commonEthRequests};
//# sourceMappingURL=index.js.map
